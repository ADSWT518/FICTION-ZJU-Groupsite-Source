{{ $ := .root }}
{{ $page := .page }}

{{ $author := "" }}
{{ if .author }}
  {{ $author = .author }}
{{ else }}
  {{ $author = $page.Params.author }}
{{end}}

{{ $person_page_path := (printf "/authors/%s" $author) }}
{{ $person_page := site.GetPage $person_page_path }}
{{ if not $person_page }}
  {{ errorf "Could not find an author page at `%s`. Please check the value of `author` in your About widget and create an associated author page if one does not already exist. See https://sourcethemes.com/academic/docs/page-builder/#about " $person_page_path }}
{{end}}
{{ $person := $person_page.Params }}
{{ $avatar := ($person_page.Resources.ByType "image").GetMatch "*avatar*" }}
{{ $avatar_shape := site.Params.avatar.shape | default "circle" }}

<!-- About widget -->
<div class="row">
  <div class="col-12 col-lg-4">
    <div id="profile">

      {{ if site.Params.avatar.gravatar }}
      <img class="avatar {{if eq $avatar_shape "square"}}avatar-square{{else}}avatar-circle{{end}}" src="https://s.gravatar.com/avatar/{{ md5 $person.email }}?s=270')" alt="{{$person_page.Title}}">
      {{ else if $avatar }}
        {{ if in (slice "group") $author }}
        <!-- <img src="/media/logoV.svg" alt="Formal Verification Group" class="svg-icon svg-baseline"> -->
        <svg viewBox="219.693 137.649 263.739 317.148" width="220" height="268">
          <rect style="stroke: currentColor; fill-rule: nonzero; stroke-linecap: round; stroke-linejoin: round; stroke-width: 5px; paint-order: fill; fill: none;" x="225.831" y="142.16" width="252.881" height="308.457" rx="15" ry="15"></rect>
          <path d="M 347.066 267.981 L 351.888 267.981 L 351.888 287.271 L 347.066 287.271 L 347.066 267.981 Z" style=""></path>
          <path d="M 361.535 287.271 L 366.356 287.271 C 369.017 287.271 371.179 285.109 371.179 282.449 L 371.179 272.804 C 371.179 270.144 369.017 267.981 366.356 267.981 L 361.535 267.981 C 358.874 267.981 356.712 270.144 356.712 272.804 L 356.712 282.449 C 356.712 285.109 358.874 287.271 361.535 287.271 Z M 361.535 272.804 L 366.356 272.804 L 366.359 282.449 L 361.535 282.449 L 361.535 272.804 Z" style=""></path>
          <path d="M 376.002 267.981 L 380.824 267.981 L 380.824 287.271 L 376.002 287.271 L 376.002 267.981 Z" style=""></path>
          <path d="M 390.47 267.981 C 387.809 267.981 385.647 270.144 385.647 272.804 L 385.647 282.449 C 385.647 285.109 387.809 287.271 390.47 287.271 L 395.292 287.271 C 397.952 287.271 400.114 285.109 400.114 282.449 L 400.114 272.804 C 400.114 270.144 397.952 267.981 395.292 267.981 L 390.47 267.981 Z M 390.47 282.449 L 390.47 272.804 L 395.292 272.804 L 395.294 282.449 L 390.47 282.449 Z" style=""></path>
          <path d="M 404.936 267.981 L 409.759 267.981 L 409.759 287.271 L 404.936 287.271 L 404.936 267.981 Z" style=""></path>
          <path d="M 432.874 258.336 L 382.588 258.336 L 382.588 239.575 L 376.61 238.079 C 375.323 232.027 372.98 226.358 369.627 221.194 L 372.791 215.92 L 359.9 203.027 L 354.625 206.19 C 353.24 205.291 351.813 204.478 350.356 203.726 L 357.354 193.233 L 397.055 193.233 L 397.055 188.41 L 392.233 188.41 L 392.233 173.942 L 387.41 173.942 L 387.41 188.41 L 382.588 188.41 L 382.588 178.764 L 377.766 178.764 L 377.766 188.41 L 372.943 188.41 L 372.943 173.942 L 368.12 173.942 L 368.12 188.41 L 363.297 188.41 L 363.297 183.586 L 358.475 183.586 L 358.475 188.41 L 354.774 188.41 L 345.908 201.708 C 343.275 200.66 340.555 199.811 337.741 199.213 L 336.243 193.233 L 318.014 193.233 L 316.516 199.212 C 310.464 200.499 304.799 202.841 299.634 206.192 L 294.358 203.029 L 281.466 215.922 L 284.629 221.195 C 281.278 226.36 278.937 232.029 277.646 238.082 L 271.669 239.575 L 271.669 257.809 L 277.646 259.304 C 278.934 265.356 281.278 271.026 284.629 276.19 L 281.466 281.461 L 294.356 294.354 L 299.633 291.19 C 304.797 294.542 310.464 296.884 316.516 298.17 L 318.014 304.15 L 325.248 304.15 L 330.069 323.44 L 377.765 323.44 L 377.765 318.618 L 372.943 318.618 L 372.943 308.973 L 368.119 308.973 L 368.119 318.618 L 363.296 318.618 L 363.296 313.796 L 358.475 313.796 L 358.475 318.618 L 353.652 318.618 L 353.652 304.15 L 348.829 304.15 L 348.829 318.618 L 344.007 318.618 L 344.007 308.973 L 339.184 308.973 L 339.184 318.618 L 333.833 318.618 L 330.214 304.15 L 336.098 304.15 L 338.51 296.916 L 432.874 296.916 L 432.874 292.094 L 335.035 292.094 L 332.624 299.328 L 321.774 299.328 L 320.444 294.005 L 318.913 293.728 C 312.443 292.556 306.442 290.072 301.074 286.352 L 299.797 285.465 L 295.106 288.279 L 287.536 280.712 L 290.35 276.022 L 289.466 274.743 C 285.745 269.375 283.264 263.372 282.09 256.904 L 281.811 255.373 L 276.491 254.042 L 276.491 243.341 L 281.812 242.011 L 282.091 240.481 C 283.263 234.01 285.746 228.009 289.466 222.642 L 290.351 221.361 L 287.536 216.67 L 295.104 209.101 L 299.795 211.915 L 301.073 211.029 C 306.442 207.308 312.443 204.827 318.912 203.652 L 320.443 203.374 L 321.774 198.054 L 332.477 198.054 L 333.808 203.377 L 335.339 203.654 C 341.81 204.827 347.81 207.311 353.178 211.03 L 354.456 211.917 L 359.146 209.103 L 366.714 216.672 L 363.901 221.363 L 364.785 222.642 C 368.505 228.009 370.987 234.011 372.162 240.481 L 372.439 242.012 L 377.765 243.34 L 377.765 258.336 L 366.977 258.336 C 367.736 255.195 368.119 251.96 368.119 248.692 C 368.119 226.088 349.732 207.7 327.127 207.7 C 304.524 207.7 286.137 226.088 286.137 248.692 C 286.137 271.294 304.524 289.682 327.127 289.682 C 331.504 289.682 335.816 288.996 339.936 287.641 L 338.429 283.059 C 337.096 283.499 335.734 283.829 334.359 284.108 L 334.359 275.785 C 334.359 273.465 333.809 271.139 332.772 269.061 C 330.211 263.933 325.058 260.748 319.325 260.748 L 309.786 260.748 C 306.563 260.748 303.43 261.392 300.469 262.659 C 298.622 263.453 296.891 264.517 295.274 265.799 C 292.524 260.702 290.959 254.877 290.959 248.692 C 290.959 246.942 291.128 245.231 291.368 243.548 C 292.273 243.756 293.188 243.868 294.112 243.868 C 297.066 243.868 299.682 245.639 300.777 248.381 C 302.607 252.964 306.984 255.925 311.917 255.925 L 324.716 255.925 C 330.035 255.925 334.361 251.6 334.361 246.281 C 334.361 240.961 330.035 236.635 324.716 236.635 C 322.056 236.635 319.894 234.473 319.894 231.813 L 319.894 227.943 C 319.894 225.266 319.11 222.674 317.625 220.446 L 314.009 215.026 C 317.821 213.536 321.94 212.675 326.249 212.571 C 325.263 214.447 324.716 216.538 324.716 218.694 C 324.716 223.187 326.949 227.358 330.686 229.85 L 335.361 232.966 C 337.755 234.563 339.183 237.234 339.183 240.107 C 339.183 247.499 345.198 253.515 352.59 253.515 C 356.417 253.515 360.057 252.446 363.226 250.483 C 363.068 253.731 362.506 256.926 361.496 259.993 L 360.453 263.159 L 432.874 263.159 L 432.874 258.336 Z M 302.366 267.091 C 304.725 266.082 307.22 265.57 309.786 265.57 L 319.325 265.57 C 323.218 265.57 326.719 267.733 328.46 271.215 C 329.168 272.627 329.539 274.207 329.539 275.785 L 329.539 284.767 C 328.738 284.82 327.935 284.861 327.127 284.861 C 315.097 284.861 304.452 278.935 297.872 269.877 C 299.265 268.714 300.769 267.777 302.365 267.091 L 302.366 267.091 Z M 313.612 223.12 C 314.568 224.554 315.071 226.222 315.071 227.944 L 315.071 231.813 C 315.071 237.132 319.397 241.458 324.716 241.458 C 327.376 241.458 329.539 243.621 329.539 246.281 C 329.539 248.941 327.376 251.103 324.716 251.103 L 311.917 251.103 C 308.963 251.103 306.347 249.333 305.253 246.592 C 303.423 242.008 299.046 239.047 294.112 239.047 C 293.529 239.047 292.944 238.972 292.361 238.829 C 295.009 229.507 301.288 221.709 309.591 217.085 L 313.612 223.12 Z M 344.006 240.108 C 344.006 235.616 341.773 231.445 338.036 228.954 L 333.361 225.837 C 330.967 224.241 329.538 221.57 329.538 218.695 C 329.538 216.528 330.428 214.476 331.94 212.881 C 348.273 215.069 361.185 228.166 363.046 244.6 C 360.174 247.239 356.505 248.693 352.589 248.693 C 347.855 248.693 344.005 244.842 344.005 240.109 L 344.006 240.108 Z" style=""></path>
          <path d="M 342.244 258.336 L 359.123 258.336 L 359.123 263.159 L 342.244 263.159 L 342.244 258.336 Z" style=""></path>
          <path d="M 419.404 267.981 C 416.745 267.981 414.583 270.144 414.583 272.804 L 414.583 282.449 C 414.583 285.109 416.745 287.271 419.404 287.271 L 424.227 287.271 C 426.887 287.271 429.05 285.109 429.05 282.449 L 429.05 272.804 C 429.05 270.144 426.887 267.981 424.227 267.981 L 419.404 267.981 Z M 419.404 282.449 L 419.404 272.804 L 424.227 272.804 L 424.23 282.449 L 419.404 282.449 Z" style=""></path>
          <path d="M 290.719 386.804 L 280.794 386.804 L 280.794 396.57 L 288.973 396.57 L 288.973 398.714 L 280.794 398.714 L 280.794 411.656 L 274.045 411.656 L 274.045 384.66 L 290.719 384.66 L 290.719 386.804 Z M 278.968 409.83 L 278.968 386.486 L 275.872 386.486 L 275.872 409.83 L 278.968 409.83 Z M 301.82 411.656 L 295.071 411.656 L 295.071 384.66 L 301.82 384.66 L 301.82 411.656 Z M 299.994 409.83 L 299.994 386.486 L 296.898 386.486 L 296.898 409.83 L 299.994 409.83 Z M 330.916 392.243 L 329.328 393.196 C 328.587 390.946 327.343 389.179 325.596 387.896 C 323.849 386.612 321.785 385.97 319.403 385.97 C 317.444 385.97 315.671 386.433 314.083 387.36 L 314.083 409.036 C 315.698 409.962 317.471 410.425 319.403 410.425 C 321.732 410.425 323.764 409.803 325.497 408.559 C 327.23 407.316 328.494 405.595 329.288 403.398 L 330.837 404.351 C 329.858 406.866 328.362 408.811 326.351 410.187 C 324.339 411.564 321.983 412.252 319.284 412.252 C 315.631 412.252 312.614 410.796 310.232 407.885 C 308.009 405.185 306.898 401.956 306.898 398.198 C 306.898 394.439 308.009 391.197 310.232 388.471 C 312.614 385.586 315.645 384.144 319.324 384.144 C 322.05 384.144 324.425 384.852 326.45 386.268 C 328.475 387.684 329.963 389.676 330.916 392.243 Z M 312.257 407.527 L 312.257 388.868 C 310.986 390.324 310.08 391.76 309.538 393.176 C 308.995 394.592 308.724 396.266 308.724 398.198 C 308.724 401.745 309.902 404.854 312.257 407.527 Z M 357.474 386.804 L 348.74 386.804 L 348.74 411.656 L 341.991 411.656 L 341.991 386.804 L 333.257 386.804 L 333.257 384.66 L 357.474 384.66 L 357.474 386.804 Z M 346.913 409.83 L 346.913 386.804 L 343.817 386.804 L 343.817 409.83 L 346.913 409.83 Z M 368.259 411.656 L 361.51 411.656 L 361.51 384.66 L 368.259 384.66 L 368.259 411.656 Z M 366.433 409.83 L 366.433 386.486 L 363.337 386.486 L 363.337 409.83 L 366.433 409.83 Z M 400.809 398.158 C 400.809 401.996 399.479 405.304 396.819 408.083 C 394.159 410.862 390.924 412.252 387.113 412.252 C 383.302 412.252 380.066 410.862 377.406 408.083 C 374.746 405.304 373.416 401.996 373.416 398.158 C 373.416 394.321 374.746 391.019 377.406 388.253 C 380.066 385.487 383.302 384.104 387.113 384.104 C 390.924 384.104 394.159 385.487 396.819 388.253 C 399.479 391.019 400.809 394.321 400.809 398.158 Z M 398.983 398.198 C 398.983 394.572 397.686 391.541 395.092 389.106 L 395.092 407.249 C 397.686 404.814 398.983 401.797 398.983 398.198 Z M 393.266 408.639 L 393.266 387.717 C 391.387 386.526 389.336 385.93 387.113 385.93 C 384.89 385.93 382.838 386.526 380.959 387.717 L 380.959 408.639 C 382.864 409.83 384.916 410.425 387.113 410.425 C 389.31 410.425 391.361 409.83 393.266 408.639 Z M 379.133 407.249 L 379.133 389.106 C 376.539 391.541 375.242 394.572 375.242 398.198 C 375.242 401.797 376.539 404.814 379.133 407.249 Z M 430.261 411.656 L 422.797 411.656 L 408.188 389.742 L 408.188 411.656 L 406.044 411.656 L 406.044 384.66 L 412.833 384.66 L 428.117 407.567 L 428.117 384.66 L 430.261 384.66 L 430.261 411.656 Z M 427.482 409.83 L 411.88 386.486 L 408.188 386.486 L 423.75 409.83 L 427.482 409.83 Z" style="fill: currentColor; white-space: pre;"></path>
        </svg>
        {{ else }}
        {{ $avatar_image := $avatar.Fill "270x270 Center" }}
        <img class="avatar {{if eq $avatar_shape "square"}}avatar-square{{else}}avatar-circle{{end}}" src="{{ $avatar_image.RelPermalink }}" alt="{{$person_page.Title}}">
        {{ end }}
      {{ end }}

      <div class="portrait-title">
        <h2>{{ $person_page.Title }}</h2>
        {{ with $person.role }}<h3>{{ . | markdownify | emojify }}</h3>{{ end }}

        {{ range $person.organizations }}
        <h3>
          {{ with .url }}<a href="{{ . }}" target="_blank" rel="noopener">{{ end }}
          <span>{{ .name }}</span>
          {{ if .url }}</a>{{ end }}
        </h3>
        {{ end }}
      </div>
      <ul class="network-icon" aria-hidden="true">
        {{ $university := $person.university }}
        {{ range $person.social }}
          {{ $pack := or .icon_pack "fas" }}
          {{ $pack_prefix := $pack }}
          {{ if in (slice "fab" "fas" "far" "fal") $pack }}
            {{ $pack_prefix = "fa" }}
          {{ end }}
          {{ $link := .link }}
          {{ $scheme := (urls.Parse $link).Scheme }}
          {{ $target := "" }}
          {{ if not $scheme }}
            {{ $link = .link | relLangURL }}
          {{ else if in (slice "http" "https") $scheme }}
            {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
          {{ end }}
          <li>
            <a href="{{ $link | safeURL }}" {{ $target | safeHTMLAttr }}>
            {{ if in (slice "Custom_University") $pack }}
              {{ if in (slice "CU") $university }}
              <img src="/media/CU.svg" alt="CU" class="svg-icon svg-baseline">
              {{ else if in (slice "Utah") $university}}
              <img src="/media/Utah_U.svg" alt="CU" class="svg-icon svg-baseline">
              {{ end }}
            {{ else }}
              <i class="{{ $pack }} {{ $pack_prefix }}-{{ .icon }}"></i>
            {{ end }}
            </a>
          </li>
        {{ end }}
      </ul>
    </div>
  </div>
  <div class="col-12 col-lg-8">

    {{/* Only display widget title in explicit instances of about widget, not in author pages. */}}
    {{ if and $page.Params.widget $page.Title }}<h1>{{ $page.Title | markdownify | emojify }}</h1>{{ end }}

    {{ $person_page.Content }}

    <div class="row">

      {{ with $person.interests }}
      <div class="col-md-5">
        <h3>{{ i18n "interests" | markdownify }}</h3>
        <ul class="ul-interests">
          {{ range . }}
          <li>{{ . | markdownify | emojify }}</li>
          {{ end }}
        </ul>
      </div>
      {{ end }}

      {{ with $person.education }}
      <div class="col-md-7">
        <h3>{{ i18n "education" | markdownify }}</h3>
        <ul class="ul-edu fa-ul">
          {{ range .courses }}
          <li>
            <i class="fa-li fas fa-graduation-cap"></i>
            <div class="description">
              <p class="course">{{ .course }}{{ with .year }}, {{ . }}{{ end }}</p>
              <p class="institution">{{ .institution }}</p>
            </div>
          </li>
          {{ end }}
        </ul>
      </div>
      {{ end }}

    </div>
  </div>
</div>

{{ with $person.academic_services }}
<div class="article-widget">
  <h3>Academic Services</h3>
  <p>
    <svg width="30px" height="30px" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M10 18C8.89543 18 8 18.8954 8 20V26C8 27.1046 8.89543 28 10 28H14V18H10ZM14 30H12V38C12 38.5523 12.4477 39 13 39C13.5523 39 14 38.5523 14 38V30ZM10 30C7.79086 30 6 28.2091 6 26V20C6 17.7909 7.79086 16 10 16H15C15.5523 16 16 16.4477 16 17V38C16 39.6569 14.6569 41 13 41C11.3431 41 10 39.6569 10 38V30Z" fill="#333333" />
    <path fill-rule="evenodd" clip-rule="evenodd"
      d="M30.4812 7.12339C30.8012 7.29903 31 7.63502 31 8V18C33.2091 18 35 19.7909 35 22V23C35 25.2091 33.2091 27 31 27V37C31 37.365 30.8012 37.701 30.4812 37.8766C30.1613 38.0522 29.771 38.0396 29.4631 37.8437L18.4631 30.8437C18.1747 30.6601 18 30.3419 18 30V15C18 14.6581 18.1747 14.3399 18.4631 14.1563L29.4631 7.15634C29.771 6.96039 30.1613 6.94776 30.4812 7.12339ZM31 25C32.1046 25 33 24.1046 33 23V22C33 20.8954 32.1046 20 31 20V25ZM20 15.5489V29.4511L29 35.1783V9.82167L20 15.5489Z"
      fill="#333333" />
    <path fill-rule="evenodd" clip-rule="evenodd"
      d="M40.832 17.4453C41.1384 17.9048 41.0142 18.5257 40.5547 18.832L37.5547 20.832C37.0952 21.1384 36.4743 21.0142 36.1679 20.5547C35.8616 20.0952 35.9858 19.4743 36.4453 19.1679L39.4453 17.1679C39.9048 16.8616 40.5257 16.9858 40.832 17.4453ZM36 24C36 23.4477 36.4477 23 37 23H41C41.5523 23 42 23.4477 42 24C42 24.5523 41.5523 25 41 25H37C36.4477 25 36 24.5523 36 24ZM36.1679 27.4453C36.4743 26.9858 37.0952 26.8616 37.5547 27.1679L40.5547 29.1679C41.0142 29.4743 41.1384 30.0952 40.832 30.5547C40.5257 31.0142 39.9048 31.1384 39.4453 30.832L36.4453 28.832C35.9858 28.5257 35.8616 27.9048 36.1679 27.4453Z"
      fill="#333333" />
    </svg>
    I serve on the following academic committees. Consider submit your work to one of the venues!</p>  
  {{ if (len .editor_committee_chair) }}
    <div class="hr-light"></div>
    <h4>Editor & Committee Chair</h4>
    <ul>
      {{ range .editor_committee_chair }}
      <li>{{ .service | markdownify }}</li>
      {{ end }}
    </ul>
  {{ end }}

  {{ if (len .committee_member) }}
    <div class="hr-light"></div>
    <h4>Committee Member</h4>
    <ul>
      {{ range .committee_member }}
      <li>{{ .service | markdownify }}</li>
      {{ end }}
    </ul>
  {{ end }}

</div>
{{ end }}